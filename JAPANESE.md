
Slide 0
こんにちは。今日は、 Vue.js向けの公式単体テストライブラリについて話させて頂きます。

Slide 1
それについて話す前に、コンポーネントというものは何か、なぜテストするか、テストするとき、何をテストするかについて話したいと思います。

Slide 2
Vueのコンポーネントを組み合わせて、ユーザーインタフェイスを構築できます。コンポーネントは、ユーザーインタフェースの一つの部分だと言えます。コンポーネントは二つのことをします。データをユーザーに表示すること、ユーザーにアプリケーションと対話できるようにすることです。

Slide
そこで、コンポーネントをテストするときは、これら二つについてテストすべきです。

Button
コンポーネントはデータをユーザーに正しく表示しますか

Button
コンポーネントはユーザーにアプリケーションと対話できるようにしますか

これはvue-test-utilsができることです。

Slide
vue-test-utilsは、Vueコンポーネントをテストするための公式ライブラリです。Reactのreact-test-utils,Enzymeのようなライブラリです。Vue, Vuex, Vue Routerと同じように、日本語のドキュメントも提供してあります。

Slide
vue-test-utilsはこのようなことをするためにツールを提供します:

コンポーネントをレンダリングし、そしてマークアップする:
    1. shallow() and mount()
    2. html(), find(), text()

コンポーネントの値(状態)/関数を設定する:
    1. data() -> setData()
    2. methods: {}  -> setMethods()
    3. computed: -> setComputed

コンポーネントのユーザーインタラクションをシュミレーションする:
    1. trigger()

プロパティをモックする:
    1. mocks: {}, stubs: {}

これらの方法について、いくつか簡単なデモを見ていきましょう。

Terminal 1
このHelloというコンポーネントは一番簡単なコンポーネントです。ただテキストを表示します。

shallowというメソッドをそのコンポーネントを隔離してレンダリングして、マークアップを検証します。`shallow`という関数は基本的なメソッドで、コンポーネントテストにほとんど全部使います。この例でshallowでレンダーして、マークアップを検証します。

次の例に行きましょう。

Terminal 2
setDataというメソッドがあります。setDataでコンポーネントのdata関数を簡単に更新できます。

また、`setMethods`, `setComputed`,`setProps`などのメソッドがあるため、簡単にデータを正しく表示するのを検証できます。この例では、変数を更新して、マークアップが正しく更新されたのを検証します。

ユーザーインタラクションはどうやってテストするのでしょうか？

Terminal 3
vue-test-utilsのtriggerというメソッドを使って、インタラクションをシミュレーションして、コンポーネントにイベントを発火できます。この例では、バトンを検索して,triggerでユーザーがボタンを押すシミュレーションして、マークアップを検証します。

これまでのところ、全てのこれらのコンポーネントは簡単でした。もう少し興味を持つ複雑な例についてはどうでしょうか？Mockコンポーネントは、Vue ルータ、Vuexストアも使っています。

Terminal 4
ここでの例では、いくつかの事が起こっています:

テキストボックスに入力するとき、ミューテーションはコミットされます。

$store.state.color によってテキストボックスの色が変わります。

Test 1
最初にボーダーの色スタイルを更新するのをテストしましょう。Vuexストアを使うとテストはもっとややこしくなります。できるだけコンポーネントをテストしたいです。vue-test-utilsではもっといい方法があります。

vuexストアのようなグローバルプロパティに注入するために、モックオブジェクトを使用できます。それから、簡単にhasStyleを使用して検証できます。この検証で、ボーダーの色が正しく更新されたのかを確認します。

時々、モックではなく本当のVuexストアを使用した方がいいときもあります。インタラクションをテストしましょう。

Test 2
ユーザーが色を入力するとき、SET_COLORミューテーションは正しいペイロードによってコミットされるべきです。

本当のミューテーションの代わりに、モックメソッドを使用できます。それから、正しいペイロードによって、それが呼ばれたとき、検証します。

このケースでは、ミューテーションをコミットしているため、テストするために本当のVuexストアを使用するとよいです。

単純にinputを探して、テキストを入力して、そしてinputをシミュレーションするためにtriggerを使用します。そして、ミューテーションをコミットしたことと、ペイロードが正しいことを検証します。

最後に、vue-test-utilsはしないことについてです。コンポーネント向けのテストライブラリーということはポイントです。`vuex`のミューテーション、アクション、ゲッターのテストに使う必要がないです。

最後に、vue-test-utilsはまだベータです。
