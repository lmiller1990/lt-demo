
こんにちは。今日は、 Vue.js向けの公式単体テストライブラリについて話させて頂きます。

それについて話す前に、コンポーネントというものは何か、なぜテストするか、テストするとき、何をテストするかについて話したいと思います。

Vueのコンポーネントを組み合わせて、ユーザーインターフェイスを構築できます。コンポーネントは、ユーザーインタフェースの一つの部分だと言えます。コンポーネントは二つのことをします：

データをユーザーに正しく表示します
ユーザーにアプリケーションと対話できるようにします

そこで、コンポーネントをテストするときは、これら二つについてテストすべきです。

これはvue-test-utilsができることです。

vue-test-utilsは、Vueコンポーネントをテストするための公式ライブラリです。Reactのreact-test-utils,Enzymeのようなライブラリです。Vue, Vuex, Vue Routerと同じように、日本語のドキュメントも提供してあります。

vue-test-utilsは以下のようなことをするためにツールを提供します:

コンポーネントをレンダリングし、そしてマークアップする:
    1. shallow() and mount()
    2. html(), find(), text()

コンポーネントの値(状態)/関数を設定する:
    1. data() -> setData()
    2. methods: {}  -> setMethods()
    3. computed: -> setComputed

コンポーネントのユーザーインタラクションをシュミレーションする:
    1. trigger()

プロパティをモックする:
    1. mocks: {}, stubs: {}

これらの方法について、いくつか簡単なデモを見ていきましょう。

このHelloというコンポーネントは一番簡単なコンポーネントです。ただテキストを表示します。

shallowというメソッドをそのコンポーネントを隔離してレンダリングして、マークアップを検証します。

setDataというメソッドがあります。setDataでコンポーネントのdata関数を簡単に更新できます。

また、`setMethods`, `setComputed`,`setProps`などのメソッドがあるため、簡単にデータを正しく表示するのを検証できます。

ユーザーインタラクションはどうやってテストするのでしょうか？triggerというメソッドを使って、インタラクションをシミュレーションして、コンポーネントにイベントを発火できます。

これまでのところ、全てのこれらのコンポーネントは簡単でした。もう少し興味を持つ複雑な例についてはどうでしょうか？Mockコンポーネントは、Vue ルータ、Vuexストアも使っています。

ここでの例では、いくつかの事が起こっています:

テキストボックスに入力するとき、ミューテーションはコミットされます。

$store.state.color によってテキストボックスの色が変わります。

最初にボーダーの色スタイルを更新するのをテストしましょう。Vuexストアを使うとテストはもっとややこしくなります。vue-test-utilsではもっといい方法があります。

グローバルプロパティに注入するために、モックオブジェクトを簡単に使用できます。それから、簡単にhasStyleを使用して検証できます。

時々、モックではなく本当のVuexストアを使用した方がいいときもあります。インタラクションをテストしましょう。

ユーザーが色を入力するとき、SET_COLORミューテーションは正しいペイロードによってコミットされるべきです。

本当のミューテーションの代わりに、モックメソッドを使用できます。それから、正しいペイロードによって、それが呼ばれたとき、検証します。

このケースでは、ミューテーションをコミットしているため、テストするために本当のVuexストアを使用するとよいです。

単純にinputを探して、テキストを入力して、そしてinputをシミュレーションするためにtriggerを使用します。
